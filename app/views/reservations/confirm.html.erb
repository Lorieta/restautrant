<div class="center-page">
  <div class="container">
    <div class="row">
      <div class="col-md-8 mx-auto">
        <div class="card">
          <div class="card-body">
            <h2 class="card-title">Confirm Reservation</h2>

            <%= render "shared/error_messages", object: @reservation %>

            <dl class="row">
              <dt class="col-sm-4">Table</dt>
              <dd class="col-sm-8">Table #<%= @reservation.table_id %> <% if @reservation.table %> (&times;<%= @reservation.table.quantity %>, seats: <%= @reservation.table.capacity %>) <% end %></dd>

              <dt class="col-sm-4">Timeslot</dt>
              <dd class="col-sm-8">
                <% if @reservation.timeslot %>
                  <%= @reservation.timeslot.date.strftime('%A, %B %-d, %Y') %> at <%= @reservation.timeslot.start_time.strftime('%I:%M %p') %>
                <% else %>
                  N/A
                <% end %>
              </dd>

              <dt class="col-sm-4">Number of People</dt>
              <dd class="col-sm-8"><%= @reservation.num_people %></dd>
            </dl>

            <hr>

            <section class="contact-info">
              <h5 class="mb-2">Contact details</h5>
              <dl class="row reservation-summary">
                <dt class="col-sm-4 text-muted">Name</dt>
                <dd class="col-sm-8"><span class="fw-bold"><%= current_user.name %></span></dd>

                <dt class="col-sm-4 text-muted">Phone</dt>
                <dd class="col-sm-8"><span class="text-muted"><%= current_user.phone.presence || 'N/A' %></span></dd>

                <dt class="col-sm-4 text-muted">Email</dt>
                <dd class="col-sm-8"><span class="text-muted"><%= current_user.email %></span></dd>
              </dl>
            </section>

            <p class="mt-3">Please review your reservation details. Click Confirm to submit your booking or Edit to return to the form.</p>

            <div class="d-flex gap-2">
              <%= form_with url: reservations_path, method: :post, local: true do |f| %>
                <%= hidden_field_tag "reservation[table_id]", @reservation.table_id %>
                <%= hidden_field_tag "reservation[timeslot_id]", @reservation.timeslot_id %>
                <%= hidden_field_tag "reservation[num_people]", @reservation.num_people %>
                <%= hidden_field_tag :confirmed, true %>
                <%= f.submit "Confirm Reservation", class: 'btn btn-primary' %>
              <% end %>

              <%# Edit link returns to new with params prefilled %>
              <%= link_to "Edit", new_reservation_path(timeslot_id: @reservation.timeslot_id, table_id: @reservation.table_id, num_people: @reservation.num_people), class: 'btn btn-outline-secondary' %>

              <%# Back depending on admin like earlier behaviour %>
              <% if defined?(current_user) && current_user.respond_to?(:admin?) && current_user.admin? %>
                <%= link_to "Back to Admin", admin_dashboard_path, class: 'btn btn-link text-muted' %>
              <% else %>
                <%= link_to "Back to Home", root_path, class: 'btn btn-link text-muted' %>
              <% end %>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>
