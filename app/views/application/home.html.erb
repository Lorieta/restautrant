<div class="home">
  <% if logged_in? %>
    <h1>Welcome back, <%= current_user.name %>!</h1>
   

      <%# Render a month calendar using simple_calendar (pass the timeslots collection and a start_date) %>
      <%= month_calendar(start_date: @month) do |date| %>
        <div class="calendar-day" style="padding:6px;">
          <strong><%= date.day %></strong>

          <% slots = @timeslots_by_date[date] || @timeslots_by_date[date.to_date] || [] %>
          <%# Only show timeslots that are open or that belong to the current user %>
          <% visible_slots = slots.select do |ts|
               ts.reservations.empty? || ts.reservations.any? { |r| r.user_id == current_user.id }
             end %>
          <% visible_slots.each do |ts| %>
            <div class="d-flex flex-column align-items-center" style="margin-top:4px;">
              <small><%= ts.start_time.strftime('%H:%M') %> - <%= ts.end_time&.strftime('%H:%M') %></small>
              <%# Show badge if the current_user has a reservation for this slot %>
              <% reservation = ts.reservations.find { |r| r.user_id == current_user.id } %>
              <% if reservation %>
                <div class="mt-1"><%= reservation_status_badge(reservation) %></div>
              <% elsif ts.reservations.empty? %>
                <%= link_to 'Book', new_reservation_path(timeslot_id: ts.id), class: 'btn btn-sm btn-primary mt-1' %>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <h1>Welcome to Restaurant Reservation</h1>
    <p class="mb-3">Sign in below or <%= link_to 'Sign up', signup_path %> to start making reservations.</p>

    <%= render 'sessions/form' %>
  <% end %>
</div>
