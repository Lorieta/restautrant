<div class="container mt-4 user-profile">
  <div class="row">
    <div class="col-md-8">
      <h1><%= @user.name %>'s Profile</h1>

      <p><strong>Email:</strong> <%= @user.email %></p>
      <% if @user.phone.present? %>
        <p><strong>Phone:</strong> <%= @user.phone %></p>
      <% end %>

      <% if current_user == @user %>
        <p>
          <%= link_to 'Edit profile', edit_user_path(@user), class: 'btn btn-primary' %>
          <%= button_to 'Logout', logout_path, method: :delete, class: 'btn btn-link' %>
        </p>
      <% end %>

      <% if current_user&.admin? %>
        <p>
          <%= link_to 'Edit user (admin)', edit_user_path(@user), class: 'btn btn-warning' %>
          <% unless current_user == @user %>
            <%= button_to 'Delete user', user_path(@user), method: :delete, data: { confirm: 'Are you sure you want to delete this user?' }, class: 'btn btn-danger' %>
          <% end %>
        </p>
      <% end %>

      <h2 class="mt-4">Reservations</h2>
      <% if @user.reservations.any? %>
        <ul class="list-group">
          <% @user.reservations.order(created_at: :desc).each do |r| %>
            <li class="list-group-item">
              <strong>Reservation for <%= if r.table
                                              "Table ##{r.table.id} â€” Number of tables: #{r.table.quantity} (Cap: #{r.table.capacity})"
                                            else
                                              'Table'
                                            end %></strong>
              <div>
                <% if r.timeslot %>
                  <%= r.timeslot.date.strftime('%B %-d, %Y') %>
                  &nbsp;from&nbsp;<%= r.timeslot.start_time.strftime('%-I:%M %p') %>
                  &nbsp;to&nbsp;<%= r.timeslot.end_time.strftime('%-I:%M %p') %>
                <% end %>
              </div>
              <div>People: <%= r.num_people %></div>
              <%= link_to 'View', reservation_path(r), class: 'btn btn-sm btn-outline-secondary ms-2' if defined?(reservation_path) %>
              <% if current_user == @user && cancellable?(r) %>
                <%= link_to 'Cancel', reservation_path(r), method: :delete, data: { confirm: 'Cancel this reservation?' }, class: 'btn btn-sm btn-danger ms-2' %>
              <% end %>
            </li>
          <% end %>
        </ul>
      <% else %>
        <p>No reservations yet.</p>
      <% end %>
    </div>
  </div>
</div>
