<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <h1>Admin Dashboard</h1>
      <p class="lead">Welcome, <%= current_user.name %>!</p>
    
      <div class="admin-summary mt-4">
        <%= render 'admin_card', title: 'Total Users', count: @users.count %>
        <%= render 'admin_card', title: 'Total Reservations', count: @reservations.count %>
        <%= render 'admin_card', title: 'Total Tables', count: @tables.count  %>
        <%= render 'admin_card', title: 'Total Timeslots', count: @timeslots.count%>
      </div>

      <div class="admin-reservations mt-4" data-controller="reservation-view" data-reservation-view-list-label-value="List" data-reservation-view-calendar-label-value="Calendar">
        <div class="admin-reservations-header">
          <h2>Reservations</h2>
          <div class="admin-reservations-switch">
            <span class="admin-reservations-switch-label">View:</span>
            <button type="button" class="btn btn-secondary btn-sm" data-action="reservation-view#toggle" data-reservation-view-target="toggle" aria-pressed="false" aria-controls="reservation-view-panels">
              List
            </button>
          </div>
        </div>

        <div id="reservation-view-panels">
          <div class="admin-calendar" data-reservation-view-target="calendar">
            <!-- View switcher -->
            <div class="admin-calendar-switcher">
              <%= link_to 'Day', admin_dashboard_path(view: 'day'), class: "btn btn-sm #{params[:view] == 'day' ? 'btn-primary' : 'btn-secondary'}" %>
              <%= link_to 'Week', admin_dashboard_path(view: 'week'), class: "btn btn-sm #{params[:view] == 'week' ? 'btn-primary' : 'btn-secondary'}" %>
              <%= link_to 'Month', admin_dashboard_path(view: nil), class: "btn btn-sm #{params[:view].blank? || params[:view] == 'month' ? 'btn-primary' : 'btn-secondary'}" %>
            </div>

            <div class="admin-calendar-wrapper">
              <% if params[:view] == 'day' %>
                <%= calendar(number_of_days: 1) do |date| %>
                  <div class="day">
                    <div class="date"><%= date.day %></div>
                    <% reservations = @reservations_by_date[date] || [] %>
                      <% if reservations.any? %>
                      <% reservations.each do |res| %>
                        <%= render partial: 'reservations/calendar_item', locals: { reservation: res } %>
                      <% end %>
                    <% else %>
                      <div class="text-muted" style="font-size: 0.8rem;">No reservations</div>
                    <% end %>
                  </div>
                <% end %>
              <% elsif params[:view] == 'week' %>
                <%= week_calendar(number_of_weeks: 1) do |date| %>
                  <div class="day">
                    <div class="date"><%= date.day %></div>
                    <% reservations = @reservations_by_date[date] || [] %>
                      <% if reservations.any? %>
                      <% reservations.each do |res| %>
                        <%= render partial: 'reservations/calendar_item', locals: { reservation: res } %>
                      <% end %>
                    <% else %>
                      <div class="text-muted" style="font-size: 0.8rem;">No reservations</div>
                    <% end %>
                  </div>
                <% end %>
              <% else %>
                <%= month_calendar do |date| %>
                  <div class="day">
                    <div class="date"><%= date.day %></div>
                    <% reservations = @reservations_by_date[date] || [] %>
                      <% if reservations.any? %>
                      <% reservations.each do |res| %>
                        <%= render partial: 'reservations/calendar_item', locals: { reservation: res } %>
                      <% end %>
                    <% else %>
                      <div class="text-muted" style="font-size: 0.8rem;">No reservations</div>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
            </div>
          </div>

          <div class="admin-reservations-list" data-reservation-view-target="list" hidden>
            <div class="d-flex justify-content-end mb-2">
              <%= link_to 'Add Reservation', new_reservation_path, class: 'btn btn-sm btn-primary' %>
            </div>
            <% if @reservations.any? %>
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>User</th>
                    <th>Table</th>
                    <th>Status</th>
                    <th>Timeslot</th>
                    <th>People</th>
                    <th>Created At</th>
                    <th class="text-end">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% @reservations.order(created_at: :desc).limit(10).each do |reservation| %>
                    <%= render partial: 'reservations/admin_row', locals: { reservation: reservation } %>
                  <% end %>
                </tbody>
              </table>
            <% else %>
              <p>No reservations yet.</p>
            <% end %>
          </div>
        </div>
      </div>

      <div class="admin-manage mt-4" id="manage-sections" data-controller="collapsible" data-collapsible-expanded-value="true">
        <div class="admin-manage-header">
          <h2>Manage Resources</h2>
       
        </div>
        <div class="admin-manage-content" id="manage-resources-content" data-collapsible-target="content">
          <%= render 'manage_users', users: (@users || []) %>
          <%= render 'manage_inventory' %>
        </div>
      </div>
    </div>
  </div>
</div>
