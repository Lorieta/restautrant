<div style="max-width: 1200px; margin: 0 auto;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
    <h2 style="margin: 0;">Timeslots</h2>
    <div class="btn-group" role="group">
      <%= link_to "Day", timeslots_path(view: 'day'), class: "btn btn-sm #{params[:view] == 'day' ? 'btn-primary' : 'btn-secondary'}" %>
      <%= link_to "Week", timeslots_path(view: 'week'), class: "btn btn-sm #{params[:view] == 'week' ? 'btn-primary' : 'btn-secondary'}" %>
      <%= link_to "Month", timeslots_path(view: nil), class: "btn btn-sm #{params[:view].blank? || params[:view] == 'month' ? 'btn-primary' : 'btn-secondary'}" %>
    </div>
  </div>

  <% if params[:view] == 'day' %>
    <%= calendar(number_of_days: 1) do |date| %>
      <div class="day">
        <div class="date"><strong><%= date.strftime('%A, %B %-d, %Y') %></strong></div>
        <% timeslots = @timeslots_by_date[date] || [] %>
        <% if timeslots.any? %>
          <% timeslots.each do |t| %>
            <div class="timeslot" id="<%= dom_id(t) %>">
              <strong><%= t.start_time.strftime("%I:%M %p") %> - <%= t.end_time.strftime("%I:%M %p") %></strong>
              <div class="actions">
                <%= link_to "Edit", edit_timeslot_path(t), class: 'btn btn-sm' %> |
                <%= link_to "Delete", timeslot_path(t),
                            class: 'btn btn-sm btn-link text-danger p-0',
                            data: {
                              action: 'confirm-modal#ask',
                              turbo_method: :delete,
                              confirm_modal_title: 'Delete Timeslot',
                              confirm_modal_message: "Delete timeslot on #{t.date} at #{t.start_time&.strftime('%I:%M %p')}?",
                              confirm_modal_confirm_text: 'Delete',
                              confirm_modal_confirm_class: 'btn btn-danger'
                            } %>
              </div>
            </div>
          <% end %>
        <% else %>
          <p class="text-muted">No timeslots for this day</p>
        <% end %>
      </div>
    <% end %>

  <% elsif params[:view] == 'week' %>
    <%= week_calendar(number_of_weeks: 1) do |date| %>
      <div class="day">
        <div class="date"><%= date.day %></div>
        <% timeslots = @timeslots_by_date[date] || [] %>
        <% if timeslots.any? %>
          <% timeslots.each do |t| %>
            <div class="timeslot" id="<%= dom_id(t) %>">
              <strong><%= t.start_time.strftime("%I:%M %p") %></strong>
              <div class="actions">
                <%= link_to "Edit", edit_timeslot_path(t), class: 'btn btn-sm' %> |
                <%= link_to "Delete", timeslot_path(t),
                            class: 'btn btn-sm btn-link text-danger p-0',
                            data: {
                              action: 'confirm-modal#ask',
                              turbo_method: :delete,
                              confirm_modal_title: 'Delete Timeslot',
                              confirm_modal_message: "Delete timeslot on #{t.date} at #{t.start_time&.strftime('%I:%M %p')}?",
                              confirm_modal_confirm_text: 'Delete',
                              confirm_modal_confirm_class: 'btn btn-danger'
                            } %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>

  <% else %>
    <%= month_calendar do |date| %>
      <div class="day">
        <div class="date"><%= date.day %></div>
        <% timeslots = @timeslots_by_date[date] || [] %>
        <% if timeslots.any? %>
          <% timeslots.each do |t| %>
            <div class="timeslot" id="<%= dom_id(t) %>">
              <strong><%= t.start_time.strftime("%I:%M %p") %></strong>
              <div class="actions">
                <%= link_to "Edit", edit_timeslot_path(t), class: 'btn btn-sm' %> |
                <%= link_to "Delete", timeslot_path(t),
                            class: 'btn btn-sm btn-link text-danger p-0',
                            data: {
                              action: 'confirm-modal#ask',
                              turbo_method: :delete,
                              confirm_modal_title: 'Delete Timeslot',
                              confirm_modal_message: "Delete timeslot on #{t.date} at #{t.start_time&.strftime('%I:%M %p')}?",
                              confirm_modal_confirm_text: 'Delete',
                              confirm_modal_confirm_class: 'btn btn-danger'
                            } %>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  <% end %>

  <div style="margin-top: 1rem;">
    <%= link_to "Add Timeslot", new_timeslot_path, class: 'btn btn-primary' %>
  </div>
</div>
